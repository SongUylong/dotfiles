#!/bin/bash

PLUGIN_DIR="$CONFIG_DIR/plugins"
ITEM_DIR="$CONFIG_DIR/items"

##### Bar Appearance #####
sketchybar --bar position=top height=40 blur_radius=0 color=0x40000000

##### Default Item Style #####
default=(
  padding_left=6
  padding_right=6
  icon.font="CaskaydiaCove Nerd Font:Bold:14.0"
  label.font="SF Pro:Semibold:13.0"
  icon.color=0xffffffff
  label.color=0xffffffff
  icon.padding_left=4
  icon.padding_right=4
  label.padding_left=0
  label.padding_right=0
  updates=on
)
sketchybar --default "${default[@]}"

##### Aerospace Workspaces #####
sketchybar --add event aerospace_workspace_change

# Workspaces with dynamic app icons
for monitor in $(aerospace list-monitors --format "%{monitor-appkit-nsscreen-screens-id}"); do
  for sid in $(aerospace list-workspaces --monitor "$monitor"); do
    display_id="1"
    if [ "$sid" -ge 6 ] && [ "$sid" -le 7 ]; then
      display_id="2"
    fi

    sketchybar --add item space.$sid left \
      --set space.$sid display="$display_id" \
      --subscribe space.$sid aerospace_workspace_change \
      --set space.$sid \
      drawing=on \
      background.color=0xff3c3e4f \
      background.corner_radius=14 \
      background.height=28 \
      background.drawing=on \
      icon.drawing=on \
      icon.color=0xffffffff \
      icon.font="CaskaydiaCove Nerd Font:Bold:16.0" \
      icon.padding_left=8 \
      icon.padding_right=8 \
      icon.y_offset=-1 \
      label.drawing=off \
      click_script="aerospace workspace $sid" \
      script="$PLUGIN_DIR/aerospace.sh $sid"
  done
done

##### Right Side Items #####
sketchybar --add item clock right \
  --set clock \
  icon="󰥔" \
  label.drawing=on \
  icon.padding_left=8 \
  icon.padding_right=4 \
  label.padding_right=8 \
  background.color=0xff3c3e4f \
  background.corner_radius=8 \
  background.height=28 \
  background.drawing=on \
  script="$PLUGIN_DIR/clock.sh" \
  update_freq=10 \
  \
  --add item battery right \
  --set battery update_freq=120 \
  script="$PLUGIN_DIR/battery.sh" \
  icon.padding_left=8 \
  icon.padding_right=4 \
  label.padding_right=8 \
  background.color=0xff3c3e4f \
  background.corner_radius=8 \
  background.height=28 \
  background.drawing=on \
  --subscribe battery system_woke power_source_change \
  \
  --add item volume right \
  --set volume script="$PLUGIN_DIR/volume.sh" \
  icon.padding_left=8 \
  icon.padding_right=4 \
  label.padding_right=8 \
  background.color=0xff3c3e4f \
  background.corner_radius=8 \
  background.height=28 \
  background.drawing=on \
  --subscribe volume volume_change \
  \
  --add item bluetooth right \
  --set bluetooth icon="󰂯" \
  label.drawing=on \
  icon.padding_left=8 \
  icon.padding_right=4 \
  label.padding_right=8 \
  background.color=0xff3c3e4f \
  background.corner_radius=8 \
  background.height=28 \
  background.drawing=on \
  script="$PLUGIN_DIR/bluetooth.sh" \
  click_script="open 'x-apple.systempreferences:com.apple.preferences.Bluetooth'" \
  update_freq=10 \
  \
  --add item wifi right \
  --set wifi icon="󰤨" \
  label.drawing=on \
  icon.padding_left=8 \
  icon.padding_right=4 \
  label.padding_right=8 \
  background.color=0xff3c3e4f \
  background.corner_radius=8 \
  background.height=28 \
  background.drawing=on \
  script="$PLUGIN_DIR/wifi.sh" \
  click_script="open 'x-apple.systempreferences:com.apple.preference.network?Wi-Fi'" \
  update_freq=10

sketchybar --update
